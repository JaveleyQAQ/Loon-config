/*
------------------------------------------
@Author: JaveleyQAQ
@Date: 2025-8-23
@Description: 高德地图APP免费换肤
------------------------------------------

[Script]
http-response ^https?://m5.amap.com/ws/ script-path=https://raw.githubusercontent.com/JaveleyQAQ/Loon-config/refs/heads/main/Scripts/gaodeMap.js, requires-body = true, timeout=60 ,enable=true,tag=🌍高德换肤

[MITM]
hostname = m5.amap.com

⚠️【免责声明】
------------------------------------------
1、此脚本仅用于学习研究，不保证其合法性、准确性、有效性，请根据情况自行判断，本人对此不承担任何保证责任。
2、由于此脚本仅用于学习研究，您必须在下载后 24 小时内将所有内容从您的计算机或手机或任何存储设备中完全删除，若违反规定引起任何事件本人对此均不负责。
3、请勿将此脚本用于任何商业或非法目的，若违反规定请自行对此负责。
4、此脚本涉及应用与本人无关，本人对因此引起的任何隐私泄漏或其他后果不承担任何责任。
5、本人对任何脚本引发的问题概不负责，包括但不限于由脚本错误引起的任何损失和损害。
6、如果任何单位或个人认为此脚本可能涉嫌侵犯其权利，应及时通知并提供身份证明，所有权证明，我们将在收到认证文件确认后删除此脚本。
7、所有直接或间接使用、查看此脚本的人均应该仔细阅读此声明。本人保留随时更改或补充此声明的权利。一旦您使用或复制了此脚本，即视为您已接受此免责声明。
*/

const _0x4e46=['L3dzL2Fvcy91c2VyL3RoZW1lL3NraW4vc2V0dXA=','SG5tVng=','Y29uc29sZQ==','ZG9uZQ==','dW5kZWZpbmVk','8J+MjemrmOW+t+WcsOWbvuaNouiCpA==','4puU77iPIHNjcmlwdCBydW4gZXJyb3Ih','RGxvRHk=','ZmluYWxseQ==','ZGVidWc=','ekx6Tkc=','aW5mbw==','TmJLV3A=','VUVqdVA=','bmd4cUE=','U1BXY08=','dGVzdA==','ImNvZGUiOjEsInJlc3VsdCI6InRydWUi','eUVJaUg=','dGFibGU=','YWloWWE=','b1hvQkE=','ZmJEUE8=','c3dXdUw=','d2Fybg==','bXNn','TGZGTnA=','U2NKVlE=','XihbXiBdKyggK1teIF0rKSspK1teIF19','aW5kZXhPZg==','aHRlTUc=','elBjRWw=','Y1pBZWU=','a3lCcFk=','YXBwbHk=','RkhEWVU=','VFdzcHo=','bmFtZQ==','RlNsWWQ=','eVd1TkU=','Ym9keQ==','Y0hEQnM=','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','cmVwbGFjZQ==','VlliSHA=','5o2i6IKk5oiQ5Yqf77yB','ZVZLZmE=','cmV0dXJuIChmdW5jdGlvbigpIA==','cHRSSW0=','L3dzL3VzZXIvdGhlbWUvc2tpbi9saXN0','RGp0bWc=','dE5tS2Q=','dmlMeW0=','Q3FOSEM=','bnNyV1U=','bWVzc2FnZQ==','R05DZ2s=','QmdPdHo=','SmxTTms=','ZXhjZXB0aW9u','TFpkeVU=','cmV0dXJuIC8iICsgdGhpcyArICIv','SVBTb0g=','ZWRYWUs=','c3BsaXQ=','QUNNYlo=','UnZXWlc=','Y29uc3RydWN0b3I=','dHJhY2U=','UHdocG8=','Z2dXQVg=','Y29tcGlsZQ==','ZXlmcm8=','dXJs','ZXJyb3I=','bG9n','WGRiVFI=','VFZNeHk=','YUtIdHE=','dkp5dGs=','cG9zdA==','Y2F0Y2g=','YVpFaU0=','SVhwUXI='];(function(_0x16008b,_0x4e46ac){const _0x406f3c=function(_0x2f7daf){while(--_0x2f7daf){_0x16008b['push'](_0x16008b['shift']());}};const _0x16f299=function(){const _0x4eac53={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x302f9c,_0x3d5f09,_0x20bcdb,_0x35a1b7){_0x35a1b7=_0x35a1b7||{};let _0x3edf15=_0x3d5f09+'='+_0x20bcdb;let _0x4a3886=0x0;for(let _0x269d77=0x0,_0x1178cf=_0x302f9c['length'];_0x269d77<_0x1178cf;_0x269d77++){const _0x5b9ac6=_0x302f9c[_0x269d77];_0x3edf15+=';\x20'+_0x5b9ac6;const _0x318546=_0x302f9c[_0x5b9ac6];_0x302f9c['push'](_0x318546);_0x1178cf=_0x302f9c['length'];if(_0x318546!==!![]){_0x3edf15+='='+_0x318546;}}_0x35a1b7['cookie']=_0x3edf15;},'removeCookie':function(){return'dev';},'getCookie':function(_0xb573f,_0x4fbeae){_0xb573f=_0xb573f||function(_0x4febf8){return _0x4febf8;};const _0x52080f=_0xb573f(new RegExp('(?:^|;\x20)'+_0x4fbeae['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));const _0x4bd7fe=function(_0x4169d3,_0x380c8a){_0x4169d3(++_0x380c8a);};_0x4bd7fe(_0x406f3c,_0x4e46ac);return _0x52080f?decodeURIComponent(_0x52080f[0x1]):undefined;}};const _0x54b3b1=function(){const _0x426b1e=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x426b1e['test'](_0x4eac53['removeCookie']['toString']());};_0x4eac53['updateCookie']=_0x54b3b1;let _0x72bca4='';const _0x4bdcc6=_0x4eac53['updateCookie']();if(!_0x4bdcc6){_0x4eac53['setCookie'](['*'],'counter',0x1);}else if(_0x4bdcc6){_0x72bca4=_0x4eac53['getCookie'](null,'counter');}else{_0x4eac53['removeCookie']();}};_0x16f299();}(_0x4e46,0xc0));const _0x406f=function(_0x16008b,_0x4e46ac){_0x16008b=_0x16008b-0x0;let _0x406f3c=_0x4e46[_0x16008b];if(_0x406f['opGLWD']===undefined){(function(){let _0x2f7daf;try{const _0x54b3b1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2f7daf=_0x54b3b1();}catch(_0x72bca4){_0x2f7daf=window;}const _0x4eac53='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x2f7daf['atob']||(_0x2f7daf['atob']=function(_0x4bdcc6){const _0x302f9c=String(_0x4bdcc6)['replace'](/=+$/,'');let _0x3d5f09='';for(let _0x20bcdb=0x0,_0x35a1b7,_0x3edf15,_0x4a3886=0x0;_0x3edf15=_0x302f9c['charAt'](_0x4a3886++);~_0x3edf15&&(_0x35a1b7=_0x20bcdb%0x4?_0x35a1b7*0x40+_0x3edf15:_0x3edf15,_0x20bcdb++%0x4)?_0x3d5f09+=String['fromCharCode'](0xff&_0x35a1b7>>(-0x2*_0x20bcdb&0x6)):0x0){_0x3edf15=_0x4eac53['indexOf'](_0x3edf15);}return _0x3d5f09;});}());_0x406f['cDMTtm']=function(_0x269d77){const _0x1178cf=atob(_0x269d77);let _0x5b9ac6=[];for(let _0x318546=0x0,_0xb573f=_0x1178cf['length'];_0x318546<_0xb573f;_0x318546++){_0x5b9ac6+='%'+('00'+_0x1178cf['charCodeAt'](_0x318546)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5b9ac6);};_0x406f['wARjIV']={};_0x406f['opGLWD']=!![];}const _0x16f299=_0x406f['wARjIV'][_0x16008b];if(_0x16f299===undefined){const _0x4fbeae=function(_0x52080f){this['xCnBuD']=_0x52080f;this['zWHlVn']=[0x1,0x0,0x0];this['DZVIjX']=function(){return'newState';};this['DVLGCs']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['IuVjDY']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4fbeae['prototype']['RGfbcT']=function(){const _0x4bd7fe=new RegExp(this['DVLGCs']+this['IuVjDY']);const _0x4febf8=_0x4bd7fe['test'](this['DZVIjX']['toString']())?--this['zWHlVn'][0x1]:--this['zWHlVn'][0x0];return this['wnfdCe'](_0x4febf8);};_0x4fbeae['prototype']['wnfdCe']=function(_0x4169d3){if(!Boolean(~_0x4169d3)){return _0x4169d3;}return this['KxPnzm'](this['xCnBuD']);};_0x4fbeae['prototype']['KxPnzm']=function(_0x380c8a){for(let _0x426b1e=0x0,_0x573a49=this['zWHlVn']['length'];_0x426b1e<_0x573a49;_0x426b1e++){this['zWHlVn']['push'](Math['round'](Math['random']()));_0x573a49=this['zWHlVn']['length'];}return _0x380c8a(this['zWHlVn'][0x0]);};new _0x4fbeae(_0x406f)['RGfbcT']();_0x406f3c=_0x406f['cDMTtm'](_0x406f3c);_0x406f['wARjIV'][_0x16008b]=_0x406f3c;}else{_0x406f3c=_0x16f299;}return _0x406f3c;};const _0x302f9c=function(){const _0xaee0d4={};_0xaee0d4[_0x406f('0x24')]='return\x20/\x22\x20+\x20this\x20+\x20\x22/';_0xaee0d4[_0x406f('0x34')]='^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}';_0xaee0d4[_0x406f('0x50')]=function(_0x157ad9,_0x2d9c50){return _0x157ad9===_0x2d9c50;};_0xaee0d4[_0x406f('0x4a')]=_0x406f('0x1a');_0xaee0d4[_0x406f('0x43')]=_0x406f('0x48');_0xaee0d4[_0x406f('0xc')]=_0x406f('0x36');_0xaee0d4['zLzNG']=_0x406f('0x16');const _0x10f96f=_0xaee0d4;let _0x394b54=!![];return function(_0x18c67f,_0x1dcd9b){const _0x18ca32={};_0x18ca32['vJytk']=_0x10f96f[_0x406f('0x24')];_0x18ca32['JArmO']=_0x10f96f[_0x406f('0x34')];_0x18ca32[_0x406f('0x49')]=function(_0x497edc,_0x5ad534){return _0x10f96f[_0x406f('0x50')](_0x497edc,_0x5ad534);};_0x18ca32[_0x406f('0x51')]=_0x10f96f[_0x406f('0x4a')];_0x18ca32[_0x406f('0x3b')]=_0x10f96f[_0x406f('0x43')];_0x18ca32[_0x406f('0x1e')]=_0x10f96f[_0x406f('0xc')];_0x18ca32[_0x406f('0x6')]=_0x10f96f[_0x406f('0x46')];const _0x4769c9=_0x18ca32;const _0x301818=_0x394b54?function(){const _0x1c23b7={};_0x1c23b7['cZAee']=_0x4769c9[_0x406f('0x37')];_0x1c23b7[_0x406f('0x2a')]=_0x4769c9['JArmO'];const _0xd83493=_0x1c23b7;if(_0x4769c9['UEjuP'](_0x4769c9['oXoBA'],_0x4769c9[_0x406f('0x3b')])){const _0x3594c7=function(){const _0xe61ad9=_0x3594c7[_0x406f('0x2b')](_0xd83493[_0x406f('0x8')])()[_0x406f('0x2f')](_0xd83493[_0x406f('0x2a')]);return!_0xe61ad9['test'](_0x4bdcc6);};return _0x3594c7();}else{if(_0x1dcd9b){if(_0x4769c9[_0x406f('0x49')](_0x4769c9['nsrWU'],_0x4769c9[_0x406f('0x6')])){const _0x3c8b41=_0x394b54?function(){if(_0x1dcd9b){const _0x296436=_0x1dcd9b[_0x406f('0xa')](_0x18c67f,arguments);_0x1dcd9b=null;return _0x296436;}}:function(){};_0x394b54=![];return _0x3c8b41;}else{const _0x178bba=_0x1dcd9b['apply'](_0x18c67f,arguments);_0x1dcd9b=null;return _0x178bba;}}}}:function(){};_0x394b54=![];return _0x301818;};}();const _0x4bdcc6=_0x302f9c(this,function(){const _0x59cf3e={};_0x59cf3e[_0x406f('0x29')]=_0x406f('0x4');const _0x28814e=_0x59cf3e;const _0x3859af=function(){const _0x22a17e=_0x3859af[_0x406f('0x2b')](_0x406f('0x25'))()[_0x406f('0x2f')](_0x28814e['ACMbZ']);return!_0x22a17e[_0x406f('0x4c')](_0x4bdcc6);};return _0x3859af();});_0x4bdcc6();const _0x4eac53=function(){const _0x47748e={};_0x47748e['rHYRJ']=function(_0x26b030,_0x597b2c){return _0x26b030!==_0x597b2c;};_0x47748e[_0x406f('0xe')]=_0x406f('0x27');_0x47748e[_0x406f('0x1d')]=_0x406f('0x35');const _0x4c86a9=_0x47748e;let _0x72fbc3=!![];return function(_0x34d2ef,_0x576d9d){const _0x29e38e=_0x72fbc3?function(){if(_0x4c86a9['rHYRJ'](_0x4c86a9[_0x406f('0xe')],_0x4c86a9[_0x406f('0x1d')])){if(_0x576d9d){const _0x5b8e61=_0x576d9d['apply'](_0x34d2ef,arguments);_0x576d9d=null;return _0x5b8e61;}}else{const _0xad3787=_0x576d9d[_0x406f('0xa')](_0x34d2ef,arguments);_0x576d9d=null;return _0xad3787;}}:function(){};_0x72fbc3=![];return _0x29e38e;};}();const _0x2f7daf=_0x4eac53(this,function(){const _0x50457e={};_0x50457e[_0x406f('0xb')]=_0x406f('0x4d');_0x50457e['BgOtz']=function(_0x5a4a46,_0xc672e){return _0x5a4a46(_0xc672e);};_0x50457e['LfFNp']='🌍高德地图换肤';_0x50457e[_0x406f('0x3a')]=function(_0x239af4,_0x261c16){return _0x239af4!==_0x261c16;};_0x50457e['ptRIm']=function(_0x572de1,_0x4a0450){return _0x572de1(_0x4a0450);};_0x50457e['AnfSK']=_0x406f('0x17');_0x50457e[_0x406f('0x7')]=_0x406f('0x12');_0x50457e[_0x406f('0x4e')]=function(_0x4d8e5d){return _0x4d8e5d();};_0x50457e[_0x406f('0x14')]='2|7|3|4|5|1|6|0';const _0x6a2841=_0x50457e;const _0x321658=function(){};const _0x22a55d=function(){let _0x12cfba;try{if(_0x6a2841[_0x406f('0x3a')](_0x406f('0x2d'),_0x406f('0x2d'))){let _0x1acc39=$response[_0x406f('0x10')];_0x1acc39=_0x1acc39[_0x406f('0x13')](/"code":10,"result":"false"/g,_0x6a2841[_0x406f('0xb')]);const _0x5975fb={};_0x5975fb[_0x406f('0x10')]=_0x1acc39;_0x6a2841[_0x406f('0x21')]($done,_0x5975fb);$notification[_0x406f('0x38')](_0x6a2841[_0x406f('0x2')],_0x406f('0x15'),'');}else{_0x12cfba=_0x6a2841[_0x406f('0x18')](Function,_0x6a2841['AnfSK']+_0x6a2841[_0x406f('0x7')]+');')();}}catch(_0x2fd5d5){_0x12cfba=window;}return _0x12cfba;};const _0x5cd13e=_0x6a2841[_0x406f('0x4e')](_0x22a55d);if(!_0x5cd13e['console']){_0x5cd13e[_0x406f('0x3e')]=function(_0x56a0b2){const _0x442082={};_0x442082[_0x406f('0x33')]=_0x56a0b2;_0x442082[_0x406f('0x0')]=_0x56a0b2;_0x442082['debug']=_0x56a0b2;_0x442082[_0x406f('0x47')]=_0x56a0b2;_0x442082[_0x406f('0x32')]=_0x56a0b2;_0x442082[_0x406f('0x23')]=_0x56a0b2;_0x442082[_0x406f('0x4f')]=_0x56a0b2;_0x442082[_0x406f('0x2c')]=_0x56a0b2;return _0x442082;}(_0x321658);}else{const _0xd42621=_0x6a2841[_0x406f('0x14')][_0x406f('0x28')]('|');let _0x1a2a9b=0x0;while(!![]){switch(_0xd42621[_0x1a2a9b++]){case'0':_0x5cd13e[_0x406f('0x3e')][_0x406f('0x2c')]=_0x321658;continue;case'1':_0x5cd13e[_0x406f('0x3e')][_0x406f('0x23')]=_0x321658;continue;case'2':_0x5cd13e[_0x406f('0x3e')][_0x406f('0x33')]=_0x321658;continue;case'3':_0x5cd13e[_0x406f('0x3e')][_0x406f('0x45')]=_0x321658;continue;case'4':_0x5cd13e[_0x406f('0x3e')]['info']=_0x321658;continue;case'5':_0x5cd13e['console'][_0x406f('0x32')]=_0x321658;continue;case'6':_0x5cd13e['console'][_0x406f('0x4f')]=_0x321658;continue;case'7':_0x5cd13e[_0x406f('0x3e')][_0x406f('0x0')]=_0x321658;continue;}break;}}});_0x2f7daf();async function crack(){const _0x37b83a={};_0x37b83a['YsrQn']=function(_0x581c1d,_0x1fe883){return _0x581c1d+_0x1fe883;};_0x37b83a[_0x406f('0x3')]=_0x406f('0x17');_0x37b83a[_0x406f('0x30')]=_0x406f('0x12');_0x37b83a['swWuL']=function(_0x5f51d1,_0x526a46){return _0x5f51d1>_0x526a46;};_0x37b83a['fbDPO']=_0x406f('0x19');_0x37b83a['yWuNE']=function(_0x439c28,_0x5b40e1){return _0x439c28===_0x5b40e1;};_0x37b83a[_0x406f('0x2e')]=_0x406f('0x22');_0x37b83a[_0x406f('0x11')]=_0x406f('0x3c');_0x37b83a[_0x406f('0x1c')]=_0x406f('0x4d');_0x37b83a[_0x406f('0x4b')]=_0x406f('0x41');_0x37b83a['IPSoH']=_0x406f('0x15');const _0x453c96=_0x37b83a;try{if(_0x453c96[_0x406f('0x53')]($request[_0x406f('0x31')]['indexOf'](_0x453c96[_0x406f('0x52')]),-0x1)){if(_0x453c96[_0x406f('0xf')](_0x453c96['ggWAX'],'nRwjx')){let _0x3c4210;try{_0x3c4210=Function(_0x453c96['YsrQn'](_0x453c96['YsrQn'](_0x453c96['ScJVQ'],_0x453c96[_0x406f('0x30')]),');'))();}catch(_0x43ed03){_0x3c4210=window;}return _0x3c4210;}else{let _0x2bab69=$response[_0x406f('0x10')];_0x2bab69=_0x2bab69[_0x406f('0x13')](/"status":(\d+)/g,'\x22status\x22:4');const _0xe0c336={};_0xe0c336[_0x406f('0x10')]=_0x2bab69;$done(_0xe0c336);}}if(_0x453c96[_0x406f('0x53')]($request[_0x406f('0x31')][_0x406f('0x5')](_0x453c96[_0x406f('0x11')]),-0x1)){let _0xb1341c=$response[_0x406f('0x10')];_0xb1341c=_0xb1341c[_0x406f('0x13')](/"code":10,"result":"false"/g,_0x453c96['viLym']);const _0x421ae2={};_0x421ae2[_0x406f('0x10')]=_0xb1341c;$done(_0x421ae2);$notification[_0x406f('0x38')](_0x453c96[_0x406f('0x4b')],_0x453c96[_0x406f('0x26')],'');}}catch(_0xa98c9e){throw _0xa98c9e;}finally{}}!(async()=>{const _0x1e666d={};_0x1e666d[_0x406f('0x1b')]=function(_0x357032,_0x57e35a){return _0x357032!=_0x57e35a;};_0x1e666d[_0x406f('0x3d')]=_0x406f('0x40');_0x1e666d[_0x406f('0x9')]='AuMpV';_0x1e666d[_0x406f('0x20')]=function(_0x43316d){return _0x43316d();};const _0x4cb7d9=_0x1e666d;try{if(_0x4cb7d9['tNmKd'](typeof $request,_0x4cb7d9[_0x406f('0x3d')])){if(_0x4cb7d9['kyBpY']!==_0x4cb7d9[_0x406f('0x9')]){const _0x17f73e=test[_0x406f('0x2b')]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x406f('0x2f')](_0x406f('0x4'));return!_0x17f73e[_0x406f('0x4c')](_0x4bdcc6);}else{await _0x4cb7d9[_0x406f('0x20')](crack);}}}catch(_0x567ba9){throw _0x567ba9;}})()[_0x406f('0x39')](_0x4fbfa5=>{$['logErr'](_0x4fbfa5),$[_0x406f('0x1')]($[_0x406f('0xd')],_0x406f('0x42'),_0x4fbfa5[_0x406f('0x1f')]||_0x4fbfa5);})[_0x406f('0x44')](async()=>{const _0x3ae9ee={};_0x3ae9ee['ok']=0x1;$[_0x406f('0x3f')](_0x3ae9ee);});
//prettier-ignore
async function sendMsg(a) { a && ($.isNode() ? await notify.sendNotify($.name, a) : $.msg($.name, $.title || "", a, { "media-url": $.avatar })) }
function DoubleLog(o) { o && ($.log(`${o}`), $.notifyMsg.push(`${o}`)) };
function debug(g, e = "debug") { "true" === $.is_debug && ($.log(`\n-----------${e}------------\n`), $.log("string" == typeof g ? g : $.toStr(g) || `debug error => t=${g}`), $.log(`\n-----------${e}------------\n`)) }
//From xream's ObjectKeys2LowerCase
function ObjectKeys2LowerCase(obj) { return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k.toLowerCase(), v])) };
//From sliverkiss's Request
async function Request(t) { "string" == typeof t && (t = { url: t }); try { if (!t?.url) throw new Error("[发送请求] 缺少 url 参数"); let { url: o, type: e, headers: r = {}, body: s, params: a, dataType: n = "form", resultType: u = "data" } = t; const p = e ? e?.toLowerCase() : "body" in t ? "post" : "get", c = o.concat("post" === p ? "?" + $.queryStr(a) : ""), i = t.timeout ? $.isSurge() ? t.timeout / 1e3 : t.timeout : 1e4; "json" === n && (r["Content-Type"] = "application/json;charset=UTF-8"); const y = s && "form" == n ? $.queryStr(s) : $.toStr(s), l = { ...t, ...t?.opts ? t.opts : {}, url: c, headers: r, ..."post" === p && { body: y }, ..."get" === p && a && { params: a }, timeout: i }, m = $.http[p.toLowerCase()](l).then((t => "data" == u ? $.toObj(t.body) || t.body : $.toObj(t) || t)).catch((t => $.log(`❌请求发起失败！原因为：${t}`))); return Promise.race([new Promise(((t, o) => setTimeout((() => o("当前请求已超时")), i))), m]) } catch (t) { console.log(`❌请求发起失败！原因为：${t}`) } }
//From chavyleung's Env.js
function Env(t, e) { class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise(((e, r) => { s.call(this, t, ((t, s, a) => { t ? r(t) : e(s) })) })) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.encoding = "utf-8", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } getEnv() { return "undefined" != typeof $environment && $environment["surge-version"] ? "Surge" : "undefined" != typeof $environment && $environment["stash-version"] ? "Stash" : "undefined" != typeof module && module.exports ? "Node.js" : "undefined" != typeof $task ? "Quantumult X" : "undefined" != typeof $loon ? "Loon" : "undefined" != typeof $rocket ? "Shadowrocket" : void 0 } isNode() { return "Node.js" === this.getEnv() } isQuanX() { return "Quantumult X" === this.getEnv() } isSurge() { return "Surge" === this.getEnv() } isLoon() { return "Loon" === this.getEnv() } isShadowrocket() { return "Shadowrocket" === this.getEnv() } isStash() { return "Stash" === this.getEnv() } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; if (this.getdata(t)) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise((e => { this.get({ url: t }, ((t, s, r) => e(r))) })) } runScript(t, e) { return new Promise((s => { let r = this.getdata("@chavy_boxjs_userCfgs.httpapi"); r = r ? r.replace(/\n/g, "").trim() : r; let a = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); a = a ? 1 * a : 20, a = e && e.timeout ? e.timeout : a; const [i, o] = r.split("@"), n = { url: `http://${o}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: a }, headers: { "X-Key": i, Accept: "*/*" }, timeout: a }; this.post(n, ((t, e, r) => s(r))) })).catch((t => this.logErr(t))) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), r = !s && this.fs.existsSync(e); if (!s && !r) return {}; { const r = s ? t : e; try { return JSON.parse(this.fs.readFileSync(r)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), r = !s && this.fs.existsSync(e), a = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, a) : r ? this.fs.writeFileSync(e, a) : this.fs.writeFileSync(t, a) } } lodash_get(t, e, s = void 0) { const r = e.replace(/\[(\d+)\]/g, ".$1").split("."); let a = t; for (const t of r) if (a = Object(a)[t], void 0 === a) return s; return a } lodash_set(t, e, s) { return Object(t) !== t || (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce(((t, s, r) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[r + 1]) >> 0 == +e[r + 1] ? [] : {}), t)[e[e.length - 1]] = s), t } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, r] = /^@(.*?)\.(.*?)$/.exec(t), a = s ? this.getval(s) : ""; if (a) try { const t = JSON.parse(a); e = t ? this.lodash_get(t, r, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, r, a] = /^@(.*?)\.(.*?)$/.exec(e), i = this.getval(r), o = r ? "null" === i ? null : i || "{}" : "{}"; try { const e = JSON.parse(o); this.lodash_set(e, a, t), s = this.setval(JSON.stringify(e), r) } catch (e) { const i = {}; this.lodash_set(i, a, t), s = this.setval(JSON.stringify(i), r) } } else s = this.setval(t, e); return s } getval(t) { switch (this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": return $persistentStore.read(t); case "Quantumult X": return $prefs.valueForKey(t); case "Node.js": return this.data = this.loaddata(), this.data[t]; default: return this.data && this.data[t] || null } } setval(t, e) { switch (this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": return $persistentStore.write(t, e); case "Quantumult X": return $prefs.setValueForKey(t, e); case "Node.js": return this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0; default: return this.data && this.data[e] || null } } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { switch (t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"], delete t.headers["content-type"], delete t.headers["content-length"]), t.params && (t.url += "?" + this.queryStr(t.params)), void 0 === t.followRedirect || t.followRedirect || ((this.isSurge() || this.isLoon()) && (t["auto-redirect"] = !1), this.isQuanX() && (t.opts ? t.opts.redirection = !1 : t.opts = { redirection: !1 })), this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": default: this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, ((t, s, r) => { !t && s && (s.body = r, s.statusCode = s.status ? s.status : s.statusCode, s.status = s.statusCode), e(t, s, r) })); break; case "Quantumult X": this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then((t => { const { statusCode: s, statusCode: r, headers: a, body: i, bodyBytes: o } = t; e(null, { status: s, statusCode: r, headers: a, body: i, bodyBytes: o }, i, o) }), (t => e(t && t.error || "UndefinedError"))); break; case "Node.js": let s = require("iconv-lite"); this.initGotEnv(t), this.got(t).on("redirect", ((t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } })).then((t => { const { statusCode: r, statusCode: a, headers: i, rawBody: o } = t, n = s.decode(o, this.encoding); e(null, { status: r, statusCode: a, headers: i, rawBody: o, body: n }, n) }), (t => { const { message: r, response: a } = t; e(r, a, a && s.decode(a.rawBody, this.encoding)) })) } } post(t, e = (() => { })) { const s = t.method ? t.method.toLocaleLowerCase() : "post"; switch (t.body && t.headers && !t.headers["Content-Type"] && !t.headers["content-type"] && (t.headers["content-type"] = "application/x-www-form-urlencoded"), t.headers && (delete t.headers["Content-Length"], delete t.headers["content-length"]), void 0 === t.followRedirect || t.followRedirect || ((this.isSurge() || this.isLoon()) && (t["auto-redirect"] = !1), this.isQuanX() && (t.opts ? t.opts.redirection = !1 : t.opts = { redirection: !1 })), this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": default: this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient[s](t, ((t, s, r) => { !t && s && (s.body = r, s.statusCode = s.status ? s.status : s.statusCode, s.status = s.statusCode), e(t, s, r) })); break; case "Quantumult X": t.method = s, this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then((t => { const { statusCode: s, statusCode: r, headers: a, body: i, bodyBytes: o } = t; e(null, { status: s, statusCode: r, headers: a, body: i, bodyBytes: o }, i, o) }), (t => e(t && t.error || "UndefinedError"))); break; case "Node.js": let r = require("iconv-lite"); this.initGotEnv(t); const { url: a, ...i } = t; this.got[s](a, i).then((t => { const { statusCode: s, statusCode: a, headers: i, rawBody: o } = t, n = r.decode(o, this.encoding); e(null, { status: s, statusCode: a, headers: i, rawBody: o, body: n }, n) }), (t => { const { message: s, response: a } = t; e(s, a, a && r.decode(a.rawBody, this.encoding)) })) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let r = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in r) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? r[e] : ("00" + r[e]).substr(("" + r[e]).length))); return t } queryStr(t) { let e = ""; for (const s in t) { let r = t[s]; null != r && "" !== r && ("object" == typeof r && (r = JSON.stringify(r)), e += `${s}=${r}&`) } return e = e.substring(0, e.length - 1), e } msg(e = t, s = "", r = "", a) { const i = t => { switch (typeof t) { case void 0: return t; case "string": switch (this.getEnv()) { case "Surge": case "Stash": default: return { url: t }; case "Loon": case "Shadowrocket": return t; case "Quantumult X": return { "open-url": t }; case "Node.js": return }case "object": switch (this.getEnv()) { case "Surge": case "Stash": case "Shadowrocket": default: return { url: t.url || t.openUrl || t["open-url"] }; case "Loon": return { openUrl: t.openUrl || t.url || t["open-url"], mediaUrl: t.mediaUrl || t["media-url"] }; case "Quantumult X": return { "open-url": t["open-url"] || t.url || t.openUrl, "media-url": t["media-url"] || t.mediaUrl, "update-pasteboard": t["update-pasteboard"] || t.updatePasteboard }; case "Node.js": return }default: return } }; if (!this.isMute) switch (this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": default: $notification.post(e, s, r, i(a)); break; case "Quantumult X": $notify(e, s, r, i(a)); case "Node.js": }if (!this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), r && t.push(r), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { switch (this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": case "Quantumult X": default: this.log("", `❗️${this.name}, 错误!`, t); break; case "Node.js": this.log("", `❗️${this.name}, 错误!`, t.stack) } } wait(t) { return new Promise((e => setTimeout(e, t))) } done(t = {}) { const e = ((new Date).getTime() - this.startTime) / 1e3; switch (this.log("", `🔔${this.name}, 结束! 🕛 ${e} 秒`), this.log(), this.getEnv()) { case "Surge": case "Loon": case "Stash": case "Shadowrocket": case "Quantumult X": default: $done(t); break; case "Node.js": process.exit(1) } } }(t, e) }
